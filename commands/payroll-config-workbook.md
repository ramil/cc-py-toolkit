---
description: Generate config workbook from functional specification
allowed-tools: Read, Write, Edit, Bash, Glob, Grep, AskUserQuestion, TodoWrite
argument-hint: <funcspec.docx>
---

Generate a SAP HCM Payroll Configuration Workbook from a Functional Specification document.

**The functional spec is the input to this command.** The functional spec contains the SAP design decisions (wage type assignments, processing classes, tax authority design, schema/PCR requirements, symbolic accounts, etc.) that translate directly into table-level configuration. Every configuration entry must trace back to a specific functional spec section, which in turn traces back to the original questionnaire.

Read the skill file at `${CLAUDE_PLUGIN_ROOT}/skills/sap-payroll-impl/SKILL.md` first. Then read ALL reference files from `${CLAUDE_PLUGIN_ROOT}/skills/sap-payroll-impl/references/`.

## AUTOMATION PURPOSE

This config workbook is designed to be **machine-readable by an ABAP report program** that can automate SAP table configuration via SM30/LSMW/BAPI. Every data tab includes:
- **SAP View/Table** column: The exact SM30 view or table name (e.g., V_T549A, T001P)
- **SAP Field Name** columns: Exact SAP field names as they appear in the table structure
- **Transaction** column: SM30, PE03, SCAL, or other tcode for configuration
- Values ready for direct table maintenance or BAPI input

Tabs 10 (Schema & PCR), 11 (Garnishment Config), 13 (Interfaces), and 14 (Benefits Config) are **documentation-only** tabs â€” they require manual ABAP development or complex setup that cannot be automated via table maintenance. These tabs retain business-friendly columns.

## Input

The user must provide a functional specification .docx file (via upload or file path). If no file is provided, ask the user to upload or specify the path.

The functional spec should have been generated by `/payroll-funcspec` (or manually authored) and contains the SAP design decisions derived from the questionnaire. The config workbook translates these design decisions into table-level SAP configuration entries.

Read and parse the functional spec to extract all company-specific design data.

## CRITICAL GENERATION REQUIREMENTS

**These requirements are NON-NEGOTIABLE. Every config workbook MUST meet ALL of these. Failure to meet any one of these makes the deliverable invalid.**

### Minimum Sheet Count: 21 tabs
The workbook MUST have at least 21 sheets including Cover/Index. Generate ALL 20 data tabs + 1 AI Analysis tab. Never skip a tab â€” if a tab has less data due to company scope, still create it with at least 1-3 rows.

### âš ï¸ APPROACH DOES NOT REMOVE TABS â€” ONLY CHANGES DEPTH
**CRITICAL MISUNDERSTANDING TO AVOID:** The Benefits Approach and Time Management Approach settings control the DEPTH (number of rows and detail level) of certain tabs. They NEVER mean you should SKIP or OMIT a tab entirely.**

**ALL 21 tabs MUST be present in EVERY config workbook regardless of approach:**

| Tab # | Tab Name | Always Required? | What Changes by Approach |
|-------|----------|-------------------|--------------------------|
| 1 | Enterprise Structure | YES â€” ALWAYS | Nothing |
| 2 | PSA Groupings | YES â€” ALWAYS | Nothing |
| 3 | Feature Configuration | YES â€” ALWAYS | Nothing |
| 4 | Payroll Areas | YES â€” ALWAYS | Nothing |
| 5 | Payroll Calendar | YES â€” ALWAYS | Nothing |
| 6 | Work Schedule Rules | YES â€” ALWAYS | Nothing |
| 7 | Wage Type Catalog | YES â€” ALWAYS | Nothing |
| 8 | Processing & Eval Classes | YES â€” ALWAYS | Nothing |
| 9 | WT Permissibility | YES â€” ALWAYS | Nothing |
| 10 | Pay Scale Structure | YES â€” ALWAYS (min 1-3 rows if no union) | Nothing |
| 11 | Tax Authorities | YES â€” ALWAYS | Nothing |
| 12 | Absence & Quota Config | YES â€” ALWAYS | DEPTH: Full=full detail, Negative=absence-only, 3rd-Party=minimal |
| 13 | Schema & PCR | YES â€” ALWAYS | Nothing |
| 14 | Garnishment Config | YES â€” ALWAYS | Nothing |
| 15 | Symbolic Accounts & GL | YES â€” ALWAYS | Nothing |
| 16 | Interfaces | YES â€” ALWAYS | Nothing |
| 17 | Benefits Config | YES â€” ALWAYS | DEPTH: Full=full detail, Deductions-Only=reference table, Hybrid=split |
| 18 | House Bank Config | YES â€” ALWAYS | Nothing |
| 19 | Validation & Test | YES â€” ALWAYS | Nothing |
| 20 | Traceability Matrix | YES â€” ALWAYS | Nothing |
| AI | AI QA Report | YES â€” ALWAYS | Nothing |

**If you generate fewer than 21 tabs, your output is INVALID. Count your tabs before saving.**

### Wage Type Catalog: MINIMUM 25+ data rows
Tab 7 (Wage Type Catalog) is the MASTER wage type list. It MUST have:
- ALL standard statutory WTs: /101 (Federal Tax), /102 (EE SS), /103 (EE Medicare), /104-/107 (state taxes), /109 (ER SS), /110 (ER Medicare), /111 (FUTA), /112 (SUTA) = 12 rows minimum
- ALL custom earnings: 1000 (Base Salary), 1010 (Regular Hours), 1020 (OT 1.5x), 1030 (OT 2.0x), 1040 (Shift Diff 2nd), 1050 (Shift Diff 3rd), 1060 (PTO Payout), 1070 (Holiday Pay), 1080 (Sick Pay), 1090 (Bereavement), 1100 (Bonus), 1110 (Commission), 1120 (Relocation), 1130 (Tuition Reimb) = 14+ rows
- ALL custom deductions: 2100 (Medical), 2110 (Dental), 2115 (Vision), 2120 (401k), 2121 (Roth 401k), 2130 (FSA), 2131 (HSA), 2140 (Basic Life EE), 2150 (Union Dues), 2160 (Garnishment) = 10+ rows
- ALL ER contributions: 3020 (ER Medical), 3030 (ER Dental), 3040 (ER Vision), 3050 (ER 401k Match), 3060 (ER Life), 3070 (ER STD), 3080 (ER LTD) = 7+ rows
Total: minimum 43 rows. Adjust up based on company's wt_count target.
**NEVER generate fewer than 25 wage type rows under any circumstances.**

### GL Accounts (HKONT): MUST BE POPULATED
Tab 15 (Symbolic Accounts & GL Posting) GL_MAP rows MUST have the HKONT column filled with realistic placeholder GL account codes:
- 51001000 = Salaries Expense
- 51002000 = Hourly Wages Expense
- 51003000 = Overtime Expense
- 52001000 = FICA Expense
- 52002000 = FUTA/SUTA Expense
- 53001000 = Benefits Expense
- 21001000 = Federal Tax Payable
- 21002000 = State Tax Payable
- 21003000 = FICA Payable
- 22001000 = Benefits Deductions Payable
- 22002000 = 401k Payable
- 23001000 = Garnishment Payable
- 10011000 = Payroll Bank Clearing
**NEVER leave HKONT blank. Yellow fill = client must confirm, but the placeholder MUST exist.**

**REINFORCEMENT: Every GL_MAP row in Tab 15 MUST have a non-blank HKONT. If you are generating Tab 15 and any GL_MAP row has an empty HKONT cell, STOP and fill it with the appropriate 5xxxxxxx/2xxxxxxx/1xxxxxxx code before saving.**

### SAP Field Names: MANDATORY in Column Headers
Tabs 1-12, 15, and 18 MUST use SAP technical field names as column headers (Row 3). At minimum these fields MUST appear: MOLGA, BUKRS, WERKS, BTRTL, PERSG, PERSK, ABKRS, LGART. Using business descriptions like "Company Code" instead of "BUKRS" causes validation failures.

### All PSAs MUST Appear in Tab 1
EVERY PSA code from the company profile MUST appear in the Enterprise Structure tab. If the company has PSAs ["NURS", "ADMN", "PHYS", "TECH", "SUPP"], ALL 5 must be in Tab 1 rows. Missing PSAs = missing downstream configuration.

### MANDATORY Tabs That Are Frequently Missed
These tabs are COMMONLY SKIPPED by the generator but MUST be present:
1. **Tab 6: Work Schedule Rules** â€” MUST have at least 3 rows (NORM + 1 shift + break detail)
2. **Tab 8: Processing & Eval Classes** â€” MUST exist with at least 5 rows showing PC01, PC10, PC20 for key WTs
3. **Tab 9: Wage Type Permissibility** â€” MUST exist with at least 5 rows
4. **Tab 12: Absence & Quota Config** â€” MUST exist with at least 3 rows (Vacation + Sick + FMLA)
5. **Tab 18: House Bank** â€” MUST exist with at least 2 rows (bank definition + account)
6. **Tab 17: Benefits Config** â€” MUST exist with at least 3 rows even for deductions-only approach

### â›” GENERATION SELF-CHECK CHECKLIST (RUN BEFORE SAVING)
Before writing the .xlsx file, mentally walk through this checklist. If ANY item fails, fix it before saving:

1. **TAB COUNT**: Count your tabs. Is it >= 21? If not, which tabs are missing? Add them.
2. **ENTERPRISE STRUCTURE (Tab 1)**: Does it have >= 10 data rows? Does it contain EVERY PSA code from the company profile? Does it have rows for Company Code, ALL PAs, ALL PSAs, EE Groups, EE Subgroups, Holiday Calendars?
3. **PSA GROUPINGS (Tab 2)**: Does it have >= 5 data rows? Each PSA needs 4 rows (B, C, K, D groupings).
4. **FEATURE CONFIG (Tab 3)**: Does it have >= 3 rows? Must have ABKRS, LGMST, SCHKZ features at minimum.
5. **PAYROLL AREAS (Tab 4)**: Does it have >= 1 row per payroll area? Include ABKRS, APTS1, PDMOD columns.
6. **PAYROLL CALENDAR (Tab 5)**: Does it have >= 12 rows? One row per pay period. Monthly=12, Biweekly=26, Weekly=52.
7. **WORK SCHEDULE (Tab 6)**: Does it have >= 3 rows? NORM schedule + at least 1 shift + break detail.
8. **WAGE TYPE CATALOG (Tab 7)**: Does it have >= 25 rows? Check /101-/112 statutory + 1000-1130 earnings + 2100-2160 deductions + 3020-3080 ER contributions are ALL present.
9. **PROCESSING CLASSES (Tab 8)**: Does it have >= 5 rows? PC01, PC10, PC20 for key wage types.
10. **PERMISSIBILITY (Tab 9)**: Does it have >= 5 rows? Which EE subgroups can use which wage types.
11. **TAX AUTHORITIES (Tab 11)**: Does it have >= 2 rows? Federal + each operating state. Must include SUI_ER_RATE or similar rate column with actual rate values (e.g., 0.027 for SUI).
12. **ABSENCE/QUOTA (Tab 12)**: Does it have >= 3 rows? Vacation + Sick + FMLA at minimum.
13. **SYMBOLIC ACCOUNTS / GL (Tab 15)**: Does EVERY row have a non-blank HKONT value? Use 51001000 (Salaries), 52001000 (FICA), 21001000 (Fed Tax Payable), etc. **ZERO blank HKONT cells allowed.**
14. **BENEFITS CONFIG (Tab 17)**: Does it have >= 1-3 rows even for deductions-only? For full benefits: plan codes, eligibility. For deductions-only: reference table.
15. **HOUSE BANK (Tab 18)**: Does it have >= 2 rows? Bank definition + account detail.
16. **SAP FIELD NAMES**: Do tabs 1-12 and 15 use SAP field names (MOLGA, BUKRS, WERKS, BTRTL, PERSG, PERSK, ABKRS, LGART) as column headers in Row 3?
17. **UNION CONFIG**: If the company has unions, is there union-related configuration (Union Dues WT 2150, CBA reference, pay scale for union groups)?
18. **NO EMPTY TABS**: Open every tab â€” does each one have at least 1 data row below the headers?

### Tax Authorities Tab: MUST Include Rate Columns
Tab 11 (Tax Authorities) MUST include tax rate columns with actual values:
- SUI_ER_RATE (State Unemployment ER rate, e.g., 0.027 for most states)
- FIT_SUPPLEMENTAL_RATE (Federal supplemental rate: 0.22)
- SIT_RATE (State income tax rate, e.g., 0.0495 for NY)
These rate columns MUST NOT be blank. Use standard default rates as placeholders.

### Union Configuration: REQUIRED for Union Companies
If the company has unions, the config workbook MUST include:
- Wage Type 2150 (Union Dues) in Tab 7
- A reference to "UNION" or "CBA" or "BARGAINING" somewhere in the workbook
- Pay Scale Structure (Tab 10) with union pay grades if applicable

## Approach-Driven Tab Selection

**Before generating tabs, read the funcspec to determine the implementation approach decisions. These control which tabs are generated and their depth.**

### Time Management Approach (from FuncSpec FS6)
- **Full Time Eval** â†’ Tab 12 is FULL (absence types + quota types + accrual rules + time types + counting/deduction rules)
- **Negative Time Only** â†’ Tab 12 is ABSENCE-ONLY (absence types, quotas, accrual rules â€” NO time types, NO time evaluation config). Add a note: "Time management = negative time. Planned hours from work schedule are actual hours unless absence is recorded."
- **3rd-Party Time Import** â†’ Tab 12 is MINIMAL (only absences managed in SAP, if any). Add a row in Tab 16 (Interfaces) for the inbound time interface.

### Benefits Approach (from FuncSpec FS7)
- **Full SAP Benefits** â†’ Tab 17 is FULL (plan types, eligibility rules, coverage tiers, carrier details, IT0167-0171 mapping)
- **Deductions Only (IT0014)** â†’ Tab 17 becomes "Benefits Deduction Reference" â€” a simplified table listing: Deduction Name | Wage Type (2xxx) | Pre/Post Tax | IRC Section | IRS Annual Limit | Eligible EE Subgroups | Per-Period Calc Method. NO SAP plan codes, NO eligibility tables, NO carrier config. The actual deduction amounts flow through Tab 7 (Wage Type Catalog) and are loaded into IT0014 in the migration file.
- **Hybrid** â†’ Tab 17 has TWO sections: "SAP-Managed Plans" (full config for 401k, etc.) and "External Deductions" (reference table for health/dental/vision IT0014 deductions).

### OM Scope (from FuncSpec)
- **No OM** â†’ No changes to config workbook (OM is not payroll config).
- **Minimal/Full OM** â†’ Add a note in Tab 1 (Enterprise Structure) that ORGEH/PLANS/STELL assignments are managed in the OM project and must be ready before migration.

## FuncSpec-to-Config Mapping

| FuncSpec Section | Config Tab | SAP Tables / Views | Automation | Conditional |
|---|---|---|---|---|
| FS2: Enterprise Structure | 1. Enterprise Structure | T001P, T500P, T501, T503, T503K | AUTO | Always |
| FS2: Enterprise Structure | 2. PSA Groupings | T589E (V_001P_B, V_001P_C, V_001P_K) | AUTO | Always |
| FS2: Enterprise Structure | 3. Feature Configuration | PE03 features (ABKRS, LGMST, SCHKZ, TARIF) | AUTO | Always |
| FS3: Payroll Areas | 4. Payroll Areas | V_T549A, T549Q | AUTO | Always |
| FS3: Payroll Calendar | 5. Payroll Calendar | T549Q (period dates) | AUTO | Always |
| FS3: Work Schedules | 6. Work Schedule Rules | T508A, T550A, T551A, T551C | AUTO | Always |
| FS4: Wage Type Catalog | 7. Wage Type Catalog | V_T511, V_T512W, V_T512T, V_T511D | AUTO | Always |
| FS4: Processing/Eval Classes | 8. Processing & Eval Classes | V_T52D0, V_T52D1 | AUTO | Always |
| FS4: Wage Type Permissibility | 9. Wage Type Permissibility | V_T511 (EE Subgroup permissibility) | AUTO | Always |
| FS4: Pay Scale (if applicable) | 10. Pay Scale Structure | T510, T510N, T510G | AUTO | If union/CBA |
| FS5: Tax Authority Design | 11. Tax Authorities | V_T5UTZ, V_T5UTY, V_T5UTM | AUTO | Always |
| FS6: Time-to-Payroll | 12. Absence & Quota Config | V_T554S, V_T554Y, T556A, T559L, T559E | AUTO | **Depth varies by Time Approach** |
| FS7: Schema & PCR Design | 13. Schema & PCR | PE01, PE02, T52C5 | MANUAL | Always |
| FS8: Garnishment Design | 14. Garnishment Config | V_T5UGS, V_T5UGT, T5UG1 | MANUAL | Always |
| FS9: Symbolic Accounts | 15. Symbolic Accounts & GL Posting | V_T52EL, V_T52E4, V_T52EK | AUTO | Always |
| FS10: Interface Specs | 16. Interfaces | Custom/Standard programs | MANUAL | Always |
| FS7: Benefits Integration | 17. Benefits Config | T5UBP, T5UB1, T74FC, V_T74FD | MANUAL | **Depth varies by Benefits Approach** |
| FS3: House Bank | 18. House Bank Config | T012, T012K | AUTO | Always |
| Cross-cutting | 19. Validation & Test Scenarios | Custom verification matrix | â€” | Always |
| All sections | 20. Traceability Matrix | Cross-reference all tabs | â€” | Always |

## Tab Specifications

For each tab, populate using these detailed column definitions. **Every automatable tab includes exact SAP field names.**

### Tab 1: Enterprise Structure
**SAP Tables:** T001P, T500P, T501, T503, T503K, SCAL
**Transaction:** SM30 (V_T500P, V_T001P_A, V_T503, V_503K)
**Columns:**

| # | Column Name | SAP Table | SAP Field | Description |
|---|---|---|---|---|
| A | Config Object Type | â€” | â€” | PA / PSA / EE Group / EE Subgroup / Holiday Calendar / Company Code |
| B | SAP View | â€” | â€” | V_T500P, V_T001P_A, V_T501, V_T503, V_503K, SCAL |
| C | Transaction | â€” | â€” | SM30 or SCAL |
| D | MOLGA | T001P | MOLGA | Country grouping: always "10" for US |
| E | BUKRS | T500P | BUKRS | Company code (4-char, e.g., "1000") |
| F | WERKS | T001P | WERKS | Personnel area code (4-char, e.g., "1000") |
| G | BTRTL | T001P | BTRTL | Personnel subarea code (4-char, e.g., "0001") |
| H | PERSG | T501 | PERSG | Employee group code (1-char: "1"=Active, "2"=Retiree, "9"=External) |
| I | PERSK | T503K | PERSK | Employee subgroup code (2-char: "01"=Sal Exempt, "02"=Hrly Non-Ex) |
| J | Description | â€” | â€” | Object description text |
| K | HOLCAL | T001P | HOLCAL | Holiday calendar ID (2-char, e.g., "01" for US Federal) |
| L | SCHKZ | T001P | SCHKZ | Default work schedule rule code |
| M | Parent Assignment | â€” | â€” | Parent code (PSAâ†’PA, PAâ†’Company Code) |
| N | IMG Path | â€” | â€” | SPRO path for configuration |
| O | Notes | â€” | â€” | Implementation notes |

**Row rules:**
- One row per: Company Code assignment (T500P), Personnel Area (T001P), Personnel Subarea (T001P), EE Group (T501), EE Subgroup (T503K), Holiday Calendar (SCAL)
- **CRITICAL: EVERY Personnel Area + Personnel Subarea combination must have a row.** If there are 4 PAs and 5 PSAs, that's potentially 20 PA+PSA rows (or fewer if not all combinations apply, but ALL PSAs must appear at least once).
- For T503 permissibility: one row per valid EE Group + EE Subgroup combination
- For Holiday Calendars: one row per calendar with HOLCAL code and state reference
- MOLGA = "10" for ALL rows (US payroll)

---

### Tab 2: PSA Groupings
**SAP Table:** T589E
**Transaction:** SM30 (V_001P_B, V_001P_C, V_001P_K, V_001P_D)
**Columns:**

| # | Column Name | SAP Table | SAP Field | Description |
|---|---|---|---|---|
| A | SAP View | â€” | â€” | V_001P_B / V_001P_C / V_001P_K / V_001P_D |
| B | MOLGA | T589E | MOLGA | "10" (US) |
| C | WERKS | T589E | WERKS | Personnel area code |
| D | BTRTL | T589E | BTRTL | Personnel subarea code |
| E | Grouping Type | â€” | â€” | Wage Type (B) / Pay Scale (C) / Work Schedule (K) / Absence (D) |
| F | LGAGR | T589E | LGAGR | Wage type grouping code (for V_001P_B) |
| G | TRFGB | T589E | TRFGB | Pay scale grouping code (for V_001P_C) |
| H | MOSID | T589E | MOSID | Work schedule grouping code (for V_001P_K) |
| I | KBWSG | T589E | KBWSG | Absence grouping code (for V_001P_D) |
| J | Description | â€” | â€” | Grouping description |
| K | Notes | â€” | â€” | Why this grouping was chosen |

**Row rules:**
- **CRITICAL: One row per PSA per grouping type.** Each PSA needs 4 rows minimum: Wage Type (B), Pay Scale (C), Work Schedule (K), Absence (D).
- Example: PSA 0001 â†’ 4 rows (B=01, C=01, K=01, D=01)
- PSA 0002 â†’ 4 rows (B=02, C=02, K=02, D=02) if different groupings

---

### Tab 3: Feature Configuration
**SAP Transaction:** PE03
**Columns:**

| # | Column Name | SAP Field | Description |
|---|---|---|---|
| A | Feature Name | â€” | ABKRS / LGMST / SCHKZ / TARIF / WPBP / PINCH |
| B | Transaction | â€” | PE03 |
| C | Decision Level | â€” | Depth in decision tree (1, 2, 3, 4...) |
| D | Decision Field | â€” | SAP field used for decision (MOLGA / PERSG / PERSK / WERKS / BTRTL) |
| E | Decision Operator | â€” | EQ (equals) / NE (not equals) / RANGE |
| F | Decision Value | â€” | Value to match (e.g., "10" for MOLGA, "1" for PERSG, "01" for PERSK) |
| G | Is Leaf Node | â€” | Y = returns result value, N = branches further |
| H | Result Field | â€” | SAP field being defaulted (ABKRS, SCHKZ, LGMST, TRFAR, etc.) |
| I | Result Value | â€” | Value to assign (e.g., payroll area "B1", WSR "NORM") |
| J | Parent Row | â€” | Row number of parent decision node (null for root) |
| K | Description | â€” | Human-readable description of this decision path |
| L | Notes | â€” | Implementation notes |

**Row rules:**
- One row per decision node in each feature tree
- Decision trees are hierarchical: Level 1 is typically MOLGA=10, Level 2 is PERSG, Level 3 is PERSK, Level 4 is WERKS/BTRTL
- Leaf nodes have Is Leaf Node = "Y" and contain the Result Value
- **ABKRS** (Payroll Area): MOLGA â†’ PERSG â†’ PERSK â†’ WERKS â†’ BTRTL â†’ Payroll Area code
- **SCHKZ** (Work Schedule Rule): MOSID (PSA work schedule grouping) â†’ PERSK â†’ WSR code
- **LGMST** (Legal Entity): WERKS â†’ Company Code
- **TARIF** (Pay Scale): MOLGA â†’ PERSG â†’ PERSK â†’ Pay Scale Type/Area
- Include Feature **PINCH** only if incentive wages apply
- Include Feature **WPBP** only if work place / business place differs from defaults

---

### Tab 4: Payroll Areas
**SAP View:** V_T549A
**Transaction:** SM30 (V_T549A)
**Columns:**

| # | Column Name | SAP Table | SAP Field | Description |
|---|---|---|---|---|
| A | SAP View | â€” | â€” | V_T549A |
| B | Transaction | â€” | â€” | SM30 |
| C | MOLGA | T549A | MOLGA | "10" (US) |
| D | ABKRS | T549A | ABKRS | Payroll area code (2-char, e.g., "B1", "W1", "M1") |
| E | APTS1 | T549A | APTS1 | Description text |
| F | PDMOD | T549A | PDMOD | Period modifier (e.g., "01"=Monthly, "02"=Biweekly, "04"=Weekly) |
| G | DATMD | T549A | DATMD | Date modifier |
| H | PAYDT | T549A | PAYDT | Pay date rule |
| I | ABKRS_RETRO | T549A | ABKR2 | Earliest retro period (YYYYMM format) |
| J | PAYSG | T549A | PAYSG | Payroll schema group (e.g., "U000" or "ZU00") |
| K | Periods/Year | â€” | â€” | Number of periods (12/24/26/52) |
| L | PCC Enabled | â€” | â€” | Y/N for Payroll Control Center |
| M | Off-Cycle Allowed | â€” | â€” | Y/N |
| N | Payment Method | â€” | â€” | T=ACH Transfer, C=Check |
| O | Default EE Subgroups | â€” | â€” | Which PERSK codes use this payroll area |
| P | Lock Timing | â€” | â€” | Days before payroll run to lock |
| Q | Notes | â€” | â€” | Implementation notes |

---

### Tab 5: Payroll Calendar
**SAP Table:** T549Q
**Transaction:** SM30 (V_T549Q)
**Columns:**

| # | Column Name | SAP Table | SAP Field | Description |
|---|---|---|---|---|
| A | SAP View | â€” | â€” | V_T549Q |
| B | Transaction | â€” | â€” | SM30 |
| C | PDMOD | T549Q | PDMOD | Period modifier code |
| D | ABKRS | T549Q | ABKRS | Payroll area code |
| E | PABRJ | T549Q | PABRJ | Year (YYYY) |
| F | PABRP | T549Q | PABRP | Period number (01, 02, ... up to periods/year) |
| G | BEGDA | T549Q | BEGDA | Period start date (YYYY-MM-DD) |
| H | ENDDA | T549Q | ENDDA | Period end date (YYYY-MM-DD) |
| I | PAYDT | T549Q | PAYDT | Pay date (YYYY-MM-DD) |
| J | PYTDT | T549Q | PYTDT | Pay run date / posting date |
| K | PERDT | T549Q | PERDT | Per diem start date |
| L | CUTDT | â€” | â€” | Cutoff date for time entries |
| M | Notes | â€” | â€” | Holiday adjustments, special periods |

**Row rules:**
- **CRITICAL: One row per pay period per payroll area per year.**
- For weekly (52 periods): 52 rows per payroll area
- For biweekly (26 periods): 26 rows per payroll area
- For monthly (12 periods): 12 rows per payroll area
- Generate for current year + next year
- Adjust pay dates that fall on weekends/holidays to previous business day
- Mark year-end periods (period 12 or 52) with note about year-end close

---

### Tab 6: Work Schedule Rules
**SAP Tables:** T508A, T550A, T551A, T551C
**Transaction:** SM30 (V_T508A, V_T550A, V_T551A, V_T551C)
**Columns:**

| # | Column Name | SAP Table | SAP Field | Description |
|---|---|---|---|---|
| A | Config Level | â€” | â€” | WSR / DWS (Daily Work Schedule) / PWS (Period Work Schedule) / DAY (Day Type) |
| B | SAP View | â€” | â€” | V_T508A / V_T550A / V_T551A / V_T551C |
| C | Transaction | â€” | â€” | SM30 |
| D | MOLGA | T508A | MOLGA | "10" (US) |
| E | MOSID | T508A | MOSID | Work schedule grouping (from Tab 2 PSA groupings) |
| F | SCHKZ | T508A | SCHKZ | Work schedule rule code (e.g., "NORM", "SH01") |
| G | TPTS1 | T508A | TPTS1 | Description |
| H | PDMOD | T508A | PDMOD | Period modifier reference |
| I | TPROG | T550A | TPROG | Daily work schedule code (e.g., "NORM", "SH01") |
| J | SOBEG | T550A | SOBEG | Shift start time (HH:MM, e.g., "08:00") |
| K | SOEND | T550A | SOEND | Shift end time (HH:MM, e.g., "17:00") |
| L | PBEG1 | T550A | PBEG1 | Break start time (HH:MM) |
| M | PEND1 | T550A | PEND1 | Break end time (HH:MM) |
| N | STDAZ | T550A | STDAZ | Planned working hours (decimal, e.g., 8.00) |
| O | VARGT | T551A | VARGT | Period schedule variant |
| P | Weekly Hours | â€” | â€” | Total weekly planned hours |
| Q | Daily OT Threshold | â€” | â€” | Hours/day triggering OT (8 for CA, null for FLSA-only) |
| R | Weekly OT Threshold | â€” | â€” | Hours/week triggering OT (40 for FLSA) |
| S | OT Multiplier 1 | â€” | â€” | First OT rate (1.5) |
| T | OT Multiplier 2 | â€” | â€” | Second OT rate (2.0 for CA >12h) |
| U | 7th Day Rule | â€” | â€” | Y/N (CA 7th consecutive day) |
| V | State | â€” | â€” | State code if state-specific OT applies |
| W | Notes | â€” | â€” | Implementation notes |

**Row rules:**
- **Multiple rows per WSR** â€” one for each config level:
  - WSR row (Config Level = "WSR"): T508A definition with SCHKZ code
  - DWS row (Config Level = "DWS"): T550A daily schedule with start/end/break times
  - PWS row (Config Level = "PWS"): T551A period pattern (M-F, rotation, etc.)
  - DAY row (Config Level = "DAY"): T551C day type assignments (work day, off day, holiday)
- For shift schedules (SH01, SH02, SH03): include start/end times per shift
- For rotating schedules (R412): include rotation pattern in Notes
- For CA workers: include Daily OT Threshold = 8, OT Multiplier 2 = 2.0, 7th Day Rule = Y

---

### Tab 7: Wage Type Catalog
**SAP Views:** V_T511, V_T512W, V_T512T, V_T511D
**Transaction:** SM30 (V_T511, V_T512W)
**Columns:**

| # | Column Name | SAP Table | SAP Field | Description |
|---|---|---|---|---|
| A | SAP View | â€” | â€” | V_T511 / V_T512W / V_T512T |
| B | Transaction | â€” | â€” | SM30 |
| C | MOLGA | T512W | MOLGA | "10" (US) |
| D | LGART | T512W | LGART | Wage type code (4-char, e.g., "1000", "2070", "/101") |
| E | LGTXT | T512T | LGTXT | Wage type description text |
| F | Category | â€” | â€” | Earning / Deduction / ER Contribution / Statutory |
| G | MDLWT | T512W | MDLWT | Model wage type to copy from (e.g., "M100", "D200") |
| H | IT_Source | â€” | â€” | Infotype source (0008/0014/0015/2001/2002/System) |
| I | OPKEN | T512W | OPKEN | Amount type indicator |
| J | EINHT | T512W | EINHT | Unit indicator (H=Hours, D=Days, $=Amount) |
| K | Pre_Post_Tax | â€” | â€” | Pre-tax / Post-tax / Statutory / N/A |
| L | IRC_Section | â€” | â€” | Sec 125 / Sec 401(k) / Roth / Sec 129 / Sec 223 / N/A |
| M | KUMKL | T512W | KUMKL | Cumulation class |
| N | Cumulation_WT | â€” | â€” | Target cumulation WT (e.g., "/300", "/310") |
| O | Print_Payslip | â€” | â€” | Y/N â€” show on pay statement |
| P | Garnish_Disposable | â€” | â€” | Include / Exclude from disposable income |
| Q | 401k_Eligible | â€” | â€” | Y/N â€” include in 401(k)-eligible comp |
| R | W2_Box | â€” | â€” | W-2 box mapping (1, 5a, 12a, 12b, etc.) |
| S | WC_Class | â€” | â€” | Workers comp class code |
| T | IRS_Annual_Limit | â€” | â€” | Annual limit amount ($) or "N/A" |
| U | Notes | â€” | â€” | Implementation notes |

**Row rules:**
- **CRITICAL: ONE ROW PER WAGE TYPE from the funcspec â€” do NOT truncate or omit any wage types.** A typical US implementation has 40-60 wage types. Generate ALL of them. If the funcspec lists 47 wage types, Tab 7 must have at least 47 data rows.
- Include ALL statutory WTs: /101 through /112
- Include ALL custom earnings (1000-1999), deductions (2000-2999), ER contributions (3000-3999)
- MOLGA = "10" for all rows
- For deductions: specify Pre_Post_Tax and IRC_Section
- For model WTs: populate MDLWT with exact model code (M100, M110, D100, D200, E100, etc.)
- **This tab is the MASTER list of wage types. Downstream tabs (8, 9, 15) reference it. Incomplete Tab 7 = incomplete configuration.**

---

### Tab 8: Processing & Evaluation Classes
**SAP Views:** V_T52D0, V_T52D1
**Transaction:** SM30 (V_T52D0, V_T52D1)
**Columns:**

| # | Column Name | SAP Table | SAP Field | Description |
|---|---|---|---|---|
| A | SAP View | â€” | â€” | V_T52D0 (Processing) or V_T52D1 (Evaluation) |
| B | Transaction | â€” | â€” | SM30 |
| C | MOLGA | T52D0 | MOLGA | "10" (US) |
| D | LGART | T52D0/D1 | LGART | Wage type code |
| E | LGTXT | â€” | â€” | Wage type description (for readability) |
| F | Class_Type | â€” | â€” | PC (Processing Class) or EC (Evaluation Class) |
| G | KLASS | T52D0 | KLASS | Processing/Evaluation class number (01, 02, 03, 10, 20, 30, 40, 71) |
| H | Class_Name | â€” | â€” | Human-readable name (e.g., "EE Grouping", "Tax Treatment") |
| I | SPEZI | T52D0 | SPEZI | Class value/specification (e.g., "01", "02") |
| J | Value_Meaning | â€” | â€” | What the value means (e.g., PC10: 01=Regular Tax, 02=Supplemental) |
| K | Is_Non_Standard | â€” | â€” | Y if value deviates from model WT default; N if standard |
| L | Notes | â€” | â€” | Why non-standard value was chosen |

**Row rules:**
- **Multiple rows per wage type** â€” one row per processing/evaluation class assignment
- Key Processing Classes for US: PC01, PC02, PC03, PC10, PC20, PC30, PC40, PC71
- Key Evaluation Classes for US: EC01, EC02, EC10, EC20
- Standard values from wage-types.md reference:
  - PC10: 01=Regular tax, 02=Supplemental, 03=Non-taxable
  - PC20: 01=Include in disposable income, 02=Exclude
  - PC30: 01=Include in benefits base, 02=Exclude
  - PC40: 01=Include in 401(k) base, 02=Exclude
  - PC71: SA code for FI posting (SA01, SA02, SA10, etc.)
  - EC01: 01=Regular earnings, 02=Supplemental, 03=Non-taxable
  - EC02: 01=Pre-tax deduction, 02=Post-tax, 03=Statutory
  - EC10: W-2 box code
  - EC20: Workers comp class
- **Flag Is_Non_Standard = "Y"** for any value that deviates from model WT defaults

---

### Tab 9: Wage Type Permissibility
**SAP View:** V_T511
**Transaction:** SM30 (V_T511)
**Columns:**

| # | Column Name | SAP Table | SAP Field | Description |
|---|---|---|---|---|
| A | SAP View | â€” | â€” | V_T511 |
| B | Transaction | â€” | â€” | SM30 |
| C | MOLGA | T511 | MOLGA | "10" (US) |
| D | LGART | T511 | LGART | Wage type code |
| E | LGTXT | â€” | â€” | Wage type description |
| F | LGAGR | T511 | LGAGR | Wage type grouping (from Tab 2, e.g., "01", "02") |
| G | PERSK_01 | T511 | â€” | Permissible for EE Subgroup 01 (X=Yes, -=No) |
| H | PERSK_02 | T511 | â€” | Permissible for EE Subgroup 02 (X=Yes, -=No) |
| I | PERSK_03 | T511 | â€” | Permissible for EE Subgroup 03 (X=Yes, -=No) |
| J | PERSK_04 | T511 | â€” | Permissible for EE Subgroup 04 (X=Yes, -=No) |
| K | PERSK_05 | T511 | â€” | Permissible for EE Subgroup 05 (X=Yes, -=No) |
| L | IT_Permissibility | â€” | â€” | V_T511D: Infotype where WT is permitted (0008/0014/0015/2001) |
| M | Notes | â€” | â€” | Permissibility logic explanation |

**Row rules:**
- One row per wage type per wage type grouping (LGAGR)
- Dynamic PERSK columns: add columns for each configured EE Subgroup (up to 10)
- Column headers should use actual PERSK code + description (e.g., "01 Sal Exempt")
- Standard permissibility from wage-types.md reference:
  - 1000 (Base Salary): 01=X, 02=-, 03=X, 04=-, 05=-
  - 1010 (Regular Hours): 01=-, 02=X, 03=-, 04=X, 05=X
  - 1020 (OT 1.5x): 01=-, 02=X, 03=-, 04=X, 05=X
  - 2070 (401k): 01=X, 02=X, 03=X, 04=-, 05=-
  - 2130 (Union Dues): 01=-, 02=X, 03=-, 04=X, 05=-

---

### Tab 10: Pay Scale Structure (if applicable)
**SAP Tables:** T510, T510N, T510G
**Transaction:** SM30 (V_T510, V_T510N, V_T510G)
**Columns:**

| # | Column Name | SAP Table | SAP Field | Description |
|---|---|---|---|---|
| A | SAP View | â€” | â€” | V_T510 / V_T510N / V_T510G |
| B | Transaction | â€” | â€” | SM30 |
| C | MOLGA | T510 | MOLGA | "10" (US) |
| D | TRFAR | T510 | TRFAR | Pay scale type (1-char, e.g., "U" for union) |
| E | TRFGB | T510 | TRFGB | Pay scale area (2-char, matches Tab 2 TRFGB) |
| F | TRFGR | T510 | TRFGR | Pay scale group (job classification code, e.g., "E01") |
| G | TRFST | T510 | TRFST | Pay scale level / step (2-char, e.g., "01", "02") |
| H | BEGDA | T510 | BEGDA | Effective date (YYYY-MM-DD) |
| I | ENDDA | T510 | ENDDA | End date (YYYY-MM-DD, 9999-12-31 for open-ended) |
| J | Annual Amount | â€” | â€” | Annual salary/wage for this group+level |
| K | Monthly Amount | â€” | â€” | Monthly equivalent |
| L | STUND | T510 | STUND | Hourly rate |
| M | Applicable PA/PSA | â€” | â€” | Which PA/PSA uses this scale |
| N | Step Progression Rule | â€” | â€” | Auto/Manual, months between steps |
| O | Step Increase % | â€” | â€” | Percentage increase per step |
| P | Notes | â€” | â€” | CBA reference, union local |

**Row rules:**
- Only include if company uses pay scales (union/CBA or government grading)
- One row per Pay Scale Type + Area + Group + Level + Effective Date
- For union CBA: include all job classifications and step levels from CBA wage table
- Include effective dates matching CBA term

---

### Tab 11: Tax Authorities
**SAP Views:** V_T5UTZ, V_T5UTY, V_T5UTM
**Transaction:** SM30 (V_T5UTZ, V_T5UTY, V_T5UTM)
**Columns:**

| # | Column Name | SAP Table | SAP Field | Description |
|---|---|---|---|---|
| A | SAP View | â€” | â€” | V_T5UTZ / V_T5UTY / V_T5UTM |
| B | Transaction | â€” | â€” | SM30 |
| C | MOLGA | T5UTZ | MOLGA | "10" (US) |
| D | Authority_Code | T5UTZ | TAXAU | Tax authority code (2-char, e.g., "FD" for federal) |
| E | BSI_State_Code | â€” | â€” | BSI numeric code (00=FED, 05=CA, 14=IL, 33=NY, 43=TX) |
| F | Description | T5UTZ | APTS1 | Authority description text |
| G | Tax_Type | â€” | â€” | INCOME / SUI / SDI / PFL / PFML / LOCAL / FUTA / FICA |
| H | IT0210_Subtype | â€” | â€” | Subtype code for IT0210 withholding info |
| I | Income_Tax | â€” | â€” | Y/N â€” does this authority levy income tax? |
| J | Tax_Method | T5UTY | TXMTH | TAX_METHOD: PROGRESSIVE / FLAT / SUPPLEMENTAL |
| K | Flat_Rate | â€” | â€” | Flat rate % (for flat-tax states: IL=4.95, PA=3.07) |
| L | Supplemental_Rate | â€” | â€” | Supplemental withholding rate % |
| M | SUI_Wage_Base | â€” | â€” | State SUI wage base amount ($) |
| N | SUI_ER_Rate | â€” | â€” | Employer SUI rate % (placeholder â€” varies by experience) |
| O | SDI_EE_Rate | â€” | â€” | SDI/TDI employee rate % |
| P | SDI_Wage_Base | â€” | â€” | SDI/TDI wage base ($) or "No cap" |
| Q | PFL_Rate | â€” | â€” | PFL/PFML employee rate % |
| R | PFL_Wage_Base | â€” | â€” | PFL/PFML wage base ($) |
| S | BSI_Geocode | â€” | â€” | Geocode format: SS-CCC-CCCC (state-county-city) |
| T | Reciprocity_States | â€” | â€” | Comma-separated state codes with reciprocity |
| U | W4_State_Form | â€” | â€” | State W-4 form name (DE 4, IT-2104, IL-W-4) |
| V | Notes | â€” | â€” | Special rules, local tax details |

**Row rules:**
- One row for Federal (BSI Code 00)
- One row per state where company operates
- Separate rows for local tax jurisdictions (NYC=33-051-0000, Philadelphia=39-101-0000)
- Separate rows for SDI/PFL/PFML where applicable (CA SDI, NY PFL, WA PFML, etc.)
- For states with no income tax (FL, TX, WA, etc.): Income_Tax = "N", still include for SUI
- Include BSI_Geocode for all authorities â€” ABAP program needs this for IT0207/0208 setup
- **ðŸ”´ TAX RATES MUST BE POPULATED** â€” NEVER leave rate columns blank. Use current-year rates from the tax-configuration.md reference:
  - SUI_ER_Rate: Use new-employer default rate for each state (e.g., CA=3.4%, NY=4.025%, TX=2.7%)
  - SDI_EE_Rate: CA=1.1%, NJ=0.06%, NY=0.50%, HI=0.50%
  - PFL_Rate: NY=0.455%, WA=0.58% (PFML), MA=0.88% (PFML), CO=0.90% (FAMLI), OR=1.0%
  - Flat_Rate: IL=4.95%, PA=3.07%, IN=3.05%, MI=4.05%, NH=5.0% (interest/dividends only)
  - Mark rates with yellow fill and note: "Rates are current-year defaults â€” client must confirm actual experience-rated SUI and carrier-specific SDI rates"

---

### Tab 12: Absence & Quota Configuration
**SAP Views:** V_T554S, V_T554Y, T556A, T559L, T559E, T559K
**Transaction:** SM30 (V_T554S, V_T556A, V_T559L, V_T559E)
**Columns:**

| # | Column Name | SAP Table | SAP Field | Description |
|---|---|---|---|---|
| A | Config Level | â€” | â€” | ABSENCE / QUOTA / ACCRUAL / COUNTING / DEDUCTION |
| B | SAP View | â€” | â€” | V_T554S / V_T556A / V_T559L / V_T559E / V_T559K |
| C | Transaction | â€” | â€” | SM30 |
| D | SUBTY | T554S | SUBTY | Absence type code (4-char, e.g., "0100"=Vacation) |
| E | Description | T554S | APTS1 | Absence type description |
| F | Category | â€” | â€” | Paid / Unpaid / Tracking |
| G | ZAEHL | T556A | ZAEHL | Counting rule code (V_T556C) |
| H | Counting_Method | â€” | â€” | Calendar Days / Work Days / Hours |
| I | ABZUG | T556A | ABZUG | Deduction rule code (V_T556R) |
| J | Deduction_Sequence | â€” | â€” | Priority: PTO â†’ Sick â†’ Unpaid |
| K | Valuation_Rule | â€” | â€” | Regular Rate / Fixed Amount / Unpaid / N/A |
| L | LGART_Generated | T556A | LGART | Payroll wage type generated (e.g., "1060" for PTO) |
| M | KTART | T559L | KTART | Quota type code (e.g., "10"=Vacation, "20"=Sick) |
| N | Annual_Entitlement | â€” | â€” | Hours or days per year |
| O | Accrual_Method | â€” | â€” | PER_PERIOD / ANNUAL_GRANT / TENURE_BASED |
| P | Accrual_Rate | T559E | ANZHL | Accrual amount per period |
| Q | Accrual_Unit | T559E | â€” | HOURS / DAYS |
| R | Max_Accrual_Balance | T559L | MAXNM | Maximum accrual balance cap |
| S | Carryover_Max | T559L | MAXCO | Maximum carryover to next year |
| T | Carryover_Expiry | â€” | â€” | Date carryover expires (e.g., "03-31" for March 31) |
| U | Payout_On_Term | â€” | â€” | Y/N â€” payout remaining balance on termination |
| V | Payout_Cap | â€” | â€” | Maximum payout amount or hours |
| W | Applicable_PERSK | â€” | â€” | EE Subgroup codes eligible (e.g., "01,02,03") |
| X | State_Mandate | â€” | â€” | Y/N â€” is this a state-mandated leave? |
| Y | State | â€” | â€” | State code (CA, NY, IL, etc.) |
| Z | Notes | â€” | â€” | State law reference, tenure tier detail |

**Row rules:**
- **Multiple rows per absence type** â€” one for each config level:
  - ABSENCE row: T554S definition with type code and description
  - QUOTA row: T559L quota definition with entitlement and caps
  - ACCRUAL row: T559E accrual rule with rate and method
  - COUNTING row: V_T556C counting rule
  - DEDUCTION row: V_T556R deduction rule and sequence
- For tenure-based accrual, include multiple ACCRUAL rows:
  - Row 1: 0-2 years service â†’ 10 days/year
  - Row 2: 3-5 years service â†’ 15 days/year
  - Row 3: 6+ years â†’ 20 days/year
  (populate T559K with service year thresholds)
- **CRITICAL**: Include state-mandated sick leave (CA, NY, IL, WA, etc.)
- Include FMLA tracking (unpaid, job-protected, LGART = null)

---

### Tab 13: Schema & PCR (MANUAL â€” Documentation Only)
**SAP Transactions:** PE01 (Schema Editor), PE02 (PCR Editor)
**Note:** Schema and PCR configuration requires ABAP development and cannot be automated via table maintenance.

**Columns:** Object Type (Schema/PCR) | Name | Copy From (Standard) | Custom Name | Purpose | Triggered By | Applicable EE Groups | Key Functions/Operations | Input WTs | Output WTs | State-Specific (Y/N) | State | Testing Notes | Transport Object | Notes

- One row per custom schema copy and per custom PCR
- **Must include**: ZU00 (copy of U000), ZTM4 (copy of TM04 if time eval customized), ZUEN (copy of UEND if custom cumulation)
- List each custom PCR with its business logic summary (CA daily OT, 401k match, imputed income, shift diff, PTO accrual, supplemental tax routing)
- Reference schemas-pcrs.md for standard PCR patterns

---

### Tab 14: Garnishment Config (MANUAL â€” Documentation Only)
**SAP Tables:** V_T5UGS, V_T5UGT, T5UG1
**Note:** Garnishment configuration has complex state-specific rules and fee handling that require manual setup.

**Columns:** Garnishment Type Code | Description | CCPA Priority | Max % of Disposable (Federal) | Max % Override (State-Specific) | Applicable States | Exempt Amount Rule | Calculation Rule (% of Disposable / Fixed / IRS Pub 1494) | Multiple Garnishment Proration | Remittance Method (Check/EFT) | Remittance Deadline (Days) | IT0194 Subtype | Fee Handling (Employer-Paid/EE-Paid) | State with Special Rules | State Rule Detail | SAP Table (V_T5UGS/V_T5UGT) | Notes

- One row per garnishment type from FS8 (CS, FL, SL, ED, CG, BK)
- Include state-specific override rows for each operating state
- **CRITICAL**: Include disposable income calculation definition
- Reference garnishments.md for CCPA rules and state variations

---

### Tab 15: Symbolic Accounts & GL Posting
**SAP Views:** V_T52EL, V_T52E4, V_T52EK
**Transaction:** SM30 (V_T52EL, V_T52E4, V_T52EK)
**Columns:**

| # | Column Name | SAP Table | SAP Field | Description |
|---|---|---|---|---|
| A | Config Level | â€” | â€” | SA_DEF (symbolic account def) / SA_MAP (WT to SA) / GL_MAP (SA to GL) / VARIANT |
| B | SAP View | â€” | â€” | V_T52EL / V_T52E4 / V_T52EK |
| C | Transaction | â€” | â€” | SM30 |
| D | MOLGA | T52EL | MOLGA | "10" (US) |
| E | SYMKO | T52EL | SYMKO | Symbolic account code (e.g., "SA01", "SA10", "SA20") |
| F | Description | â€” | â€” | Symbolic account description |
| G | Account_Category | â€” | â€” | Expense / Tax Liability / Benefit Liability / Net Pay / Bank |
| H | LGART | T52EL | LGART | Wage type mapped to this SA (for SA_MAP rows) |
| I | BUKRS | T52E4 | BUKRS | Company code (for GL_MAP rows) |
| J | WERKS | T52E4 | WERKS | Personnel area (for PA-specific GL mapping, or blank) |
| K | HKONT | T52E4 | HKONT | GL account number (10-digit) |
| L | Debit_Credit | â€” | â€” | D (Debit/Expense) or C (Credit/Liability) |
| M | Cost_Object_Type | â€” | â€” | KOSTL (Cost Center) / AUFNR (Internal Order) / PSPNR (WBS) |
| N | Cost_Derivation | â€” | â€” | IT0001 (from org assignment) / IT0027 (cost distribution) / FIXED |
| O | ABKRS_VARIANT | T52EK | ABKRS | Posting variant payroll area (for VARIANT rows) |
| P | Post_Date_Rule | T52EK | â€” | ENDDA (period end) / PAYDT (pay date) / CUSTOM |
| Q | Doc_Type | â€” | â€” | Document type (default "PY") |
| R | Doc_Splitting | â€” | â€” | Y/N â€” split by cost center |
| S | Notes | â€” | â€” | Implementation notes |

**Row rules:**
- **SA_DEF rows**: One per symbolic account (SA01 through SA41)
- **SA_MAP rows**: One per wage type â†’ symbolic account mapping (V_T52EL). Map every WT in Tab 7 to a symbolic account:
  - SA01: 1000, 1010, 1020, 1030, 1060-1090 (Salaries & Wages)
  - SA02: 1040, 1041, 1050 (Shift & Premium)
  - SA03: 1100-1170 (Bonus & Commission)
  - SA10: /109, /110 (ER FICA)
  - SA11: /111, /112 (ER FUTA/SUTA)
  - SA12: 3020-3095 (ER Benefits)
  - SA20: /101 (Federal Tax Payable)
  - SA21: /104-/107 (State/Local Tax Payable)
  - SA22: /102, /103, /109, /110 (FICA Payable)
  - SA30: 2060-2091 (Benefit Deduction Payable)
  - SA31: 2070-2072, 3050 (401k Payable)
  - SA40: Net Pay (clearing)
  - SA41: Bank (disbursement clearing)
- **GL_MAP rows**: One per SA + Company Code + PA combination (V_T52E4)
  - **ðŸ”´ GL accounts MUST be populated with realistic placeholder GL codes** â€” NEVER leave HKONT column empty. Use industry-standard COA patterns:
    - 5100xxxx = Salaries & Wages expense
    - 5200xxxx = Payroll Tax expense
    - 5300xxxx = Benefits expense
    - 2100xxxx = Tax Liability (payable)
    - 2200xxxx = Benefits Liability (payable)
    - 2300xxxx = Garnishment Liability (payable)
    - 1001xxxx = Bank/Cash (clearing)
  - Use yellow fill (#FFFFF0) for GL accounts to indicate client must confirm actual COA codes
- **VARIANT rows**: One per posting variant configuration (V_T52EK)
- **ðŸ”´ðŸ”´ðŸ”´ EXAMPLE GL_MAP DATA (copy this pattern â€” HKONT MUST NEVER be blank):**
  | SA_DEF | V_T52EL | SM30 | 10 | SA01 | Salaries & Wages | Expense | | | | | | | | | | | |
  | GL_MAP | V_T52E4 | SM30 | 10 | SA01 | Salaries & Wages | Expense | 1000 | 1000 | | 51001000 | D | KOSTL | IT0001 | | | PY | |
  | GL_MAP | V_T52E4 | SM30 | 10 | SA10 | ER FICA Expense | Expense | /109 | 1000 | | 52001000 | D | KOSTL | IT0001 | | | PY | |
  | GL_MAP | V_T52E4 | SM30 | 10 | SA20 | Federal Tax Payable | Tax Liability | /101 | 1000 | | 21001000 | C | | | | | PY | |
  | GL_MAP | V_T52E4 | SM30 | 10 | SA40 | Net Pay | Net Pay | | 1000 | | 10011000 | C | | | | | PY | |
  **If HKONT is blank in ANY GL_MAP row, the config workbook FAILS validation.**

---

### Tab 16: Interfaces (MANUAL â€” Documentation Only)
**Note:** Interface configuration requires ABAP development and middleware setup.

**Columns:** Interface ID | Name | Direction (Inbound/Outbound) | Source System | Target System | SAP Program | Middleware | File Format | Protocol (SFTP/BAPI/IDoc) | Frequency | Trigger (Scheduled/Event) | File Naming Convention | Key Fields Mapped | Error Handling | Retry Logic | Monitoring (SM37/SLG1) | Archive Retention | Contact/Owner | Notes

- One row per interface from FS10
- Include ALL standard interfaces: FI posting (RPCIPTU0), ACH (RFFOUS_T), positive pay, tax filing (RPCTAXU0), 401k, benefits carriers, WC, time import, new hire, benefits elections
- Reference interfaces.md for standard SAP programs

---

### Tab 17: Benefits Configuration (MANUAL â€” Documentation Only)
**SAP Tables:** T5UBP, T5UB1, T74FC, V_T74FD
**Note:** Benefits require custom PCR development (401k match, imputed income) and carrier rate setup.

**Columns:** Benefit Plan Code | Plan Name | Plan Type (Health/Dental/Vision/401k/FSA/HSA/Life/STD/LTD/Union) | Provider/Carrier | Eligibility Rule (All Active/FT Only/Union Only/Waiting Period) | Waiting Period (Days) | Coverage Tiers (EE/EE+SP/EE+CH/Family) | EE Premium WT | ER Contribution WT | EE Contribution Type (Flat/% of Salary) | ER Contribution Type (Flat/Match %/Formula) | Match Formula Detail | Annual EE Limit (IRS) | Annual ER Limit | Vesting Schedule | Auto-Enroll (Y/N) | Default Election | Imputed Income (Y/N) | Imputed Threshold | SAP Infotypes (IT0167/0168/0171) | Notes

- One row per benefit plan from funcspec
- **CRITICAL**: Include 401k match formula with tiers
- Include IRS limits for 401k, FSA, HSA, group-term life $50K threshold
- Include union-specific benefits if applicable

---

### Tab 18: House Bank Configuration
**SAP Tables:** T012, T012K
**Transaction:** SM30 (V_T012, V_T012K)
**Columns:**

| # | Column Name | SAP Table | SAP Field | Description |
|---|---|---|---|---|
| A | SAP View | â€” | â€” | V_T012 / V_T012K |
| B | Transaction | â€” | â€” | SM30 |
| C | BUKRS | T012 | BUKRS | Company code |
| D | HBKID | T012 | HBKID | House bank ID (4-char, e.g., "MAIN") |
| E | Bank_Name | T012 | BANKN | Bank name |
| F | BANKL | T012 | BANKL | Bank key / routing number (9-digit ABA) |
| G | Bank_Country | T012 | BANKS | Bank country ("US") |
| H | HKTID | T012K | HKTID | Account ID (4-char, e.g., "PAY1") |
| I | BANKN | T012K | BANKN | Bank account number |
| J | Account_Type | â€” | â€” | Checking / Savings |
| K | ZLSCH | T012K | ZLSCH | Payment method (T=ACH Transfer, C=Check) |
| L | NACHA_Format | â€” | â€” | CCD+ (corporate) / PPD+ (employee) |
| M | Pre_Note_Days | â€” | â€” | Pre-note period (typically 10 days) |
| N | Notes | â€” | â€” | Implementation notes |

**Row rules:**
- One row per house bank (T012) and one row per bank account (T012K)
- Most companies have 1 house bank with 1-2 accounts (payroll disbursement + tax payment)
- Use yellow fill for actual bank account numbers (client must provide)

---

### Tab 19: Validation & Test Scenarios
**Columns:** Test ID | Category | Scenario Description | Employee Type | State | Input Data | Expected Result | Calculation Detail | Tolerance | Config Tab Reference | SAP Transaction | Pass/Fail | Notes

- Include test scenarios for every critical calculation:
  - Regular pay: salaried monthly, hourly biweekly, hourly weekly
  - OT: federal weekly OT, CA daily OT (>8, >12), CA 7th day, weighted average OT
  - Tax: federal withholding by filing status, state tax per state, supplemental flat rate
  - Deductions: pre-tax 401k, Roth 401k, Section 125, FSA, HSA, post-tax life
  - ER contributions: FICA match, FUTA, SUTA, 401k match tiers, group life
  - Garnishment: single garnishment, multiple garnishments by priority, CS + tax levy
  - Absence: PTO accrual, sick leave accrual, tenure-based tier change
  - FI posting: GL account derivation, cost center allocation, multi-PA posting
  - Shift differential: 2nd shift premium, 3rd shift premium, split-shift
  - Off-cycle: termination with PTO payout, mid-period correction, bonus run
- SAP Transaction column: PC00_M10_CALC_SIMU (payroll sim), PT60 (time eval), RPCIPTU0 (posting)

---

### Tab 20: Traceability Matrix
**Columns:**

| # | Column Name | Description |
|---|---|---|
| A | Questionnaire Section | Source questionnaire section ID |
| B | Question/Item | Specific question or requirement |
| C | FuncSpec Section | Functional spec section (FS2, FS3, etc.) |
| D | FuncSpec Design Decision | Summary of design decision |
| E | Config Tab | Which tab in this workbook |
| F | Config Row Reference | Row number or ID in the config tab |
| G | SAP Table | SAP table being configured |
| H | SAP Field | Specific field in the table |
| I | SAP View | SM30 view name |
| J | Transaction | SM30, PE03, SCAL, etc. |
| K | IMG Path | SPRO/IMG navigation path |
| L | Test Scenario ID | Link to Tab 19 test case |
| M | Status | Configured / Pending / N/A |

- Full cross-reference linking questionnaire â†’ funcspec â†’ config â†’ SAP table â†’ test
- One row per configuration item
- Include status tracking for implementation progress

## AI-Powered Configuration Intelligence

After generating all 20 data tabs, use the LLM to add intelligence layers:

### AI Analysis Tab (Tab 21 â€” "AI Analysis")
Add a new tab called "AI Analysis" with the following AI-generated content:

**Section 1: Configuration Summary Narrative**
Call the AI to generate a 2-3 paragraph narrative summarizing:
- What was configured, how many objects per category
- Key design choices reflected in the configuration
- Dependencies between tabs (e.g., Tab 9 permissibility depends on Tab 1 EE Subgroups)

**Section 2: Conflict Detection Report**
Call the AI to cross-check ALL tabs and identify potential conflicts:
- Wage types in Tab 8 (Processing Classes) that don't exist in Tab 7 (Catalog)
- EE Subgroups in Tab 9 (Permissibility) that don't exist in Tab 1 (Enterprise Structure)
- Tax authorities in Tab 11 with states not represented in Tab 1 (no PA for that state)
- Symbolic account mappings in Tab 15 referencing wage types not in Tab 7
- Work schedule groupings in Tab 6 not matching Tab 2 (PSA Groupings)
- Pay scale groupings referenced in Tab 10 not matching Tab 2

Format as a table: Conflict ID | Severity | Tab A | Tab B | Description | Resolution

**Section 3: Automation Readiness Assessment**
Call the AI to assess each tab's readiness for ABAP program consumption:
- Are all SAP field values in the correct format?
- Are there any placeholder or TBD values that block automation?
- Which tabs can be loaded immediately vs. which need client input first?
- Estimated LSMW/BAPI effort per tab

**Section 4: Smart Test Scenarios**
Call the AI to generate **15-20 intelligent test scenarios** based on the ACTUAL configuration (not generic templates). Each scenario should:
- Reference specific wage types, payroll areas, and tax authorities from the workbook
- Test edge cases unique to this company's setup
- Include expected calculation values
- Specify which SAP transaction to use for verification

These AI-generated test scenarios should REPLACE the generic ones in Tab 19 â€” or be added as "AI-Recommended" scenarios alongside the standard ones.

### AI Commentary Cells
For each automation tab (1-12, 15, 18), add a final column called "AI_Note" that contains AI-generated per-row commentary:
- Flags for non-standard configurations
- Cross-reference validations ("This WT 1020 should have PC10=01 for regular tax treatment â€” verify")
- Best practice recommendations ("Consider adding a separate WSR for CA employees due to daily OT")

## Generation Strategy

**CRITICAL: Every tab MUST contain data rows. Do NOT create empty placeholder tabs.**

This workbook has 22 tabs which is too large for a single Python script. Use a **two-pass generation approach**:

### Pass 1: Core Configuration (Tabs 1-12 + 15 + 18)
Generate these automatable tabs FIRST â€” they are the primary deliverable:

| Tab | Name | Min Rows | Priority |
|-----|------|----------|----------|
| 1 | Enterprise Structure | 15+ (PAs + PSAs + EE Groups + Subgroups + Calendars) | P1 |
| 2 | PSA Groupings | 4 Ã— number_of_PSAs Ã— number_of_PAs (each PSA+PA needs B/C/K/D groupings) | P1 |
| 3 | Feature Configuration | 10+ (ABKRS + SCHKZ + LGMST decision trees) | P1 |
| 4 | Payroll Areas | 1 per payroll area (typically 2-4) | P1 |
| 5 | Payroll Calendar | periods_per_year Ã— number_of_payroll_areas (e.g., 90 for W1+B1+M1) | P1 |
| 6 | Work Schedule Rules | 3 Ã— number_of_schedules (WSR + DWS + PWS per schedule) | P1 |
| 7 | Wage Type Catalog | ALL wage types from funcspec (typically 40-60) â€” NO TRUNCATION | P1 |
| 8 | Processing & Eval Classes | 5+ classes Ã— number_of_key_WTs (typically 25-50 rows) | P2 |
| 9 | WT Permissibility | 1 per WT Ã— number of LGAGR groupings (typically 15-30 rows) | P2 |
| 10 | Pay Scale Structure | Only if union/CBA applies (7-20 rows) | P2 |
| 11 | Tax Authorities | 1 per tax authority (Federal + states + locals, typically 8-15 rows) | P1 |
| 12 | Absence & Quota Config | 5 Ã— number_of_absence_types (typically 15-25 rows) | P2 |
| 15 | Symbolic Accounts & GL | SA_DEF + SA_MAP + GL_MAP rows (typically 20-40 rows) | P2 |
| 18 | House Bank | 2-3 rows (bank + accounts) | P2 |

### Pass 2: Documentation & Analysis (Tabs 13-14, 16-17, 19-21)
Then generate these tabs â€” they are documentation/manual tabs:

| Tab | Name | Min Rows |
|-----|------|----------|
| 13 | Schema & PCR (MANUAL) | 5+ (custom schemas + PCRs) |
| 14 | Garnishment Config (MANUAL) | 4+ (one per garnishment type) |
| 16 | Interfaces (MANUAL) | 6+ (one per interface) |
| 17 | Benefits Config (MANUAL) | 8+ (one per benefit plan) |
| 19 | Validation & Test Scenarios | 15+ (test cases) |
| 20 | Traceability Matrix | 15+ (cross-references) |
| 21 | AI Analysis | 5+ (narrative sections) |

**If the Python script is getting too long, split into two sequential scripts** â€” the second script opens the file created by the first script and adds the remaining tabs. But NEVER save with empty tabs.

### Completeness Verification
After generating, verify EVERY tab has data rows >= the minimum above. If any tab is empty, add data before saving the file.

## Output Format

Generate .xlsx using Python openpyxl with **21 tabs** (20 data tabs + 1 AI Analysis tab) as defined above.

Format requirements:
- Tab 0 (first sheet): Cover/Index tab with project info and listing of all 20 tabs with record counts
  - Include legend: AUTO tabs (green header accent) vs MANUAL tabs (orange header accent)
  - Include automation summary: which tabs can be processed by ABAP report
- Professional styling: navy header row (#1F4E79, white text, bold), thin gray borders on all cells
- Light yellow fill (#FFFFF0) on cells requiring client-specific input (GL accounts, bank details, rates)
- Light green fill (#E8F5E9) on cells populated from funcspec (validated values)
- Auto-filters on all data tabs
- Freeze panes at row 4 (below title row, subtitle row, and header row)
- Row 1: Tab title (merged, 14pt bold)
- Row 2: SAP table references, views, transaction codes, and IMG path (merged, 10pt italic)
- Row 3: Column headers (navy fill, white text, bold, wrapped)
- Column widths optimized for content readability (min 12, max 40 characters)
- Arial 10pt throughout
- Data validation dropdowns where applicable (Y/N fields, pre/post tax, config levels, etc.)
- Conditional formatting: red fill on any cell marked "MISSING" or "TBD"
- Recalculate with recalc script if formulas are used
- Include a "Notes" or "Legend" section on the Cover tab explaining color codes

**CRITICAL for automation tabs (1-12, 15, 18):**
- Every row must have SAP View and Transaction columns populated
- Every SAP field column must use exact SAP field names (not business descriptions)
- MOLGA = "10" for all US payroll rows
- Values must be ready for direct SM30 table maintenance or LSMW/BAPI input
- **NEVER invent field names with "ESSION" suffix** â€” field names like MESSION, PESSION, PAESSION, AESSION, VESSION, MOESSION, KESSION, TRESSION, STESSION, WESSION, HESSION, SAESSION, BESSION, ZESSION, DESSION, QUESSION, UESSION are ALL hallucinated/invalid. Use the EXACT field names defined in the tab specs above (e.g., FKALS, PDMOD, ABKRS, KLASS, SPEZI, TRFAR, TRFGB, TRFGR, TRFST, STUND, SUBTY, ZAEHL, ABZUG, KTART, HKONT, HBKID, MDLWT, OPKEN, EINHT, KUMKL, VARGT).

### TOP CONFIG WORKBOOK FAILURE POINTS (from exhaustive testing)

1. **ðŸ”´ ENTERPRISE STRUCTURE MUST HAVE >= 10 ROWS** â€” Include ALL PA Ã— PSA combinations. If you have 3 PAs and 4 PSAs, that's 12 rows minimum. Also include EE Group and EE Subgroup definition rows to ensure >= 10 total.

2. **ðŸ”´ PSA GROUPINGS MUST HAVE >= 5 ROWS** â€” Each PSA needs 4 grouping types (B/C/K/D). Even with 2 PSAs that's 8 rows. Ensure this tab is never underpopulated.

3. **ðŸ”´ ALL TABS MUST HAVE DATA** â€” Every configuration tab must have actual data rows, not just headers. The Benefits tab is commonly missed â€” it MUST exist with one row per benefit plan.

4. **ðŸ”´ SAP FIELD NAMES MUST APPEAR** â€” At minimum MOLGA, BUKRS, WERKS, BTRTL, PERSG, PERSK must appear in Tab 1 column headers. At least 5 of the 8 standard SAP fields must be present.

5. **ðŸ”´ ALL PSAs MUST APPEAR IN TAB 1** â€” Every PSA code from the company profile must appear in the Enterprise Structure tab. Missing PSAs means incomplete configuration.

6. **ðŸ”´ GL ACCOUNTS IN TAB 15 MUST NOT BE EMPTY** â€” The HKONT column must have realistic placeholder GL account codes (5100xxxx for wages, 2100xxxx for liabilities, etc.). An empty HKONT column means FI posting cannot be automated. Use yellow fill to flag for client confirmation, but NEVER leave blank.

7. **ðŸ”´ TAX RATES IN TAB 11 MUST NOT BE BLANK** â€” SUI_ER_Rate, SDI_EE_Rate, PFL_Rate, and Flat_Rate columns must be populated with current-year default rates. Blank rate columns make the config workbook look incomplete and block automation testing.

8. **ðŸ”´ BENEFITS TAB APPROACH MUST MATCH FUNCSPEC** â€” If the funcspec says "Deductions Only via IT0014", Tab 17 should be a simple deduction reference table, NOT a full SAP Benefits plan configuration. Generating full plan config when the client uses external benefits creates confusion.

Save to workspace outputs as `SAP_Payroll_ConfigWorkbook_[CompanyName].xlsx`.

## Output Self-Validation (LLM QA Gate)

**After generating the .xlsx file, perform a mandatory LLM-powered self-validation before presenting it to the user.** This catches issues that would otherwise propagate to the migration file.

### Step 1: Programmatic Structural Verification
Write and execute a Python validation script that opens the generated .xlsx and checks:

```
VALIDATION CHECKLIST (all must pass):
â–¡ Total sheet count >= 15 (minimum for a complete config workbook)
â–¡ Tab 1 (Enterprise Structure): >= 10 data rows, ALL PA+PSA combinations present
â–¡ Tab 2 (PSA Groupings): >= 5 data rows per PA
â–¡ Tab 3 (Feature Config): >= 3 data rows (ABKRS, SCHKZ, LGMST minimum)
â–¡ Tab 4 (Payroll Areas): >= 1 row per configured payroll area
â–¡ Tab 5 (Payroll Calendar): >= 12 period rows (monthly minimum; 26 for biweekly, 52 for weekly)
â–¡ Tab 6 (Work Schedule): >= 3 data rows
â–¡ Tab 7 (Wage Type Catalog): ALL wage types present (ZERO truncation â€” compare count to funcspec)
â–¡ Tab 8 (Processing/Eval Classes): >= 5 data rows
â–¡ Tab 9 (WT Permissibility): >= 5 data rows
â–¡ Tab 11 (Tax Authorities): >= 1 row per state + federal
â–¡ Tab 12 (Absence/Quota): >= 3 data rows
â–¡ Tab 15 (Symbolic Accounts): >= 3 data rows
â–¡ Tab 17 (Benefits): >= 1 row per benefit plan
â–¡ Tab 18 (House Bank): >= 1 data row
â–¡ NO empty data tabs (every tab has at least 1 data row beyond headers)
â–¡ NO cells containing "ESSION" pattern fields (scan ALL cells)
â–¡ SAP field names present: MOLGA, BUKRS, WERKS, BTRTL, PERSG, PERSK found in first few tabs
```

### Step 2: LLM Semantic Review
Pass a summary of all tab contents (headers + first 3 data rows + row counts) to the AI and verify:
1. **SAP field correctness**: Are column headers using exact SAP field names (not business descriptions)?
2. **Value validity**: Are MOLGA values all "10"? Are codes in valid SAP ranges?
3. **Cross-tab consistency**: Do PA/PSA codes in Tab 1 match those used in Tab 2, Tab 3, Tab 5, Tab 6?
4. **Wage type integrity**: Do WT codes in Tab 7 follow the expected pattern? (1xxx=earnings, 2xxx=deductions, 3xxx=ER)
5. **Tax authority format**: Are BSI geocodes in SS-CCC-CCCC format? Federal = 00-000-0000?
6. **Processing class accuracy**: Are PC01, PC10, PC20 values standard for each WT category?
7. **Benefits completeness**: Does Tab 17 cover all benefit plans from funcspec?
8. **ESSION anti-pattern**: Confirm zero hallucinated field names

### Step 3: Auto-Fix and Report
- If any tab has 0 data rows, **GENERATE DATA** for it before saving (do NOT leave empty tabs)
- If ESSION fields are found, **REPLACE** with correct SAP field names
- If wage type count is below funcspec target, **ADD MISSING** wage types
- If any PSA is missing from Tab 1, **ADD** the missing PA+PSA rows

After all fixes, generate and print a **validation scorecard**:
```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  CONFIG WORKBOOK VALIDATION SCORECARD
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  Sheets generated:  XX / 21
  Total data rows:   XXX
  Structural checks: XX / XX passed
  ESSION scan:       CLEAN / X found
  Wage types:        XX / XX from funcspec
  SAP field accuracy: PASS / FAIL
  Empty tab check:   PASS / FAIL
  Cross-tab consistency: PASS / FAIL
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  OVERALL:           PASS / FAIL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

**If OVERALL = FAIL, fix the issues and re-validate before presenting to user.**
**Always report the scorecard to the user when presenting the output.**

After generating and validating, summarize:
- Total tabs and record counts per tab
- Validation scorecard results
- Automation readiness: how many tabs are AUTO vs MANUAL
- Any funcspec items that could NOT be translated to config (flag for follow-up)
- Highlight any items marked as requiring client decision (yellow fill cells)
